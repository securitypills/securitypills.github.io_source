---
title: Ethernaut - Level 06 - Delegation
date: 2022-07-28
---

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.6.0;

contract Delegate {

  address public owner;

  constructor(address _owner) public {
    owner = _owner;
  }

  function pwn() public {
    owner = msg.sender;
  }
}

contract Delegation {

  address public owner;
  Delegate delegate;

  constructor(address _delegateAddress) public {
    delegate = Delegate(_delegateAddress);
    owner = msg.sender;
  }

  fallback() external {
    (bool result,) = address(delegate).delegatecall(msg.data);
    if (result) {
      this;
    }
  }
}
```
FIGURE 1 -- Contract's source code

## Where is the vulnerability?
The `Delegation` fallback implements a `delegatecall`. By sending the right `msg.data` it is possible to trigger the `pwn()` function on the Delegate contract and become the contract’s owner. Since this function will be executed by a `delegatecall`, the context will be preserved.

## Key Concepts
Before we deep-dive into the contract’s implementation, lets explain some concepts that will make easier for us to understand the vulnerability that needs to be exploited in order to claim ownership of the contract.

Solidity provides different ways to call external contracts from within a given contract:

- **ABI is available**: The contract Application Binary Interface (ABI), is the standard way to interact with contracts in the Ethereum ecosystem, both from outside the blockchain and for contract-to-contract interaction. In this scenario, if the ABI and the contract’s address are known, we can simply instantiate the contract and call its functions.
- **ABI is not available: Use `delegatecall` or `call` opcodes**:  In Ethereum, the transaction’s input data that is generated after making a call can be broken down into two subparts:
    - A method selector: First 4 bytes of a function call’s bytecode. Generated by hashing (kecccak256) the method’s name and the type of  arguments expected.
    - The remaining input are method arguments in chunks of 32 bytes